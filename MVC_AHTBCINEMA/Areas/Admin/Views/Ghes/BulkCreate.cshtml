@model AHTBCinema_NHOM4_SD18301.ViewModels.BulkCreateGheViewModel

@{
    ViewData["Title"] = "Tạo mới nhiều ghế";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<h1>Tạo mới nhiều ghế</h1>

<h4>Thông tin Ghế</h4>
<hr />
<form id="bulkCreateForm" asp-action="BulkCreate">
    <div class="text-danger" id="formErrorSummary"></div>

    <div class="row justify-content-center">
        <div class="form-group m-2 col-4">
            <label asp-for="SoLuongGhe" class="control-label">Số Lượng Ghế</label>
            <input asp-for="SoLuongGhe" required class="form-control" />
            <span class="text-danger" asp-validation-for="SoLuongGhe" id="SoLuongGhe-error"></span>
        </div>
        <div class="form-group m-2 col-4">
            <label asp-for="Phong" class="control-label">Phòng</label>
            <select asp-for="Phong" class="form-control" id="PhongDropdown" asp-items="Model.PhongList">
                <option value="">-- Chọn Phòng --</option>
            </select>
            <span class="text-danger" id="Phong-error"></span>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="form-group m-2 col-4">
            <label asp-for="GioChieuId" class="control-label">Giờ Chiếu</label>
            <select asp-for="GioChieuId" class="form-control" id="GioChieuDropdown">
            </select>
            <span class="text-danger" id="GioChieuId-error"></span>
        </div>
        <div class="form-group m-2 col-4">
            <label asp-for="TrangThai" class="control-label">Trạng Thái</label>
            <select asp-for="TrangThai" class="form-control">
                <option value="Trống">Trống</option>
                <option value="Đã có">Đã có</option>
            </select>
            <span class="text-danger" id="TrangThai-error"></span>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="form-group m-2 col-4">
            <label asp-for="LoaiGhe" class="control-label">Loại Ghế</label>
            <select asp-for="LoaiGhe" class="form-control" asp-items="Model.LoaiGheList"></select>
            <span class="text-danger" id="LoaiGhe-error"></span>
        </div>
        <div class="form-group m-2 col-4">
            <label asp-for="StartingSeatLetter" class="control-label">Chữ cái ghế</label>
            <input asp-for="StartingSeatLetter" class="form-control" />
            <span class="text-danger" asp-validation-for="StartingSeatLetter" id="StartingSeatLetter-error"></span>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="form-group m-2 col-4">
            <label asp-for="GiaVe" class="control-label">Giá Vé</label>
            <input asp-for="GiaVe" required type="number" class="form-control" />
            <span class="text-danger" asp-validation-for="GiaVe" id="GiaVe-error"></span>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="">
            <a asp-action="Index" class="btn btn-danger m-2 col-7">Quay lại danh sách</a>
        </div>
        <div class="form-group m-2 col-3">
            <input type="submit" value="Tạo mới" class="btn btn-primary" disabled />
        </div>
    </div>
</form>

<script>
    document.getElementById('PhongDropdown').addEventListener('change', function () {
        var phongId = this.value;
        var gioChieuDropdown = document.getElementById('GioChieuDropdown');

        if (phongId) {
            fetch('/Admin/Ghes/GetGioChieusByPhong?phongId=' + phongId)
                .then(response => response.json())
                .then(data => {
                    gioChieuDropdown.innerHTML = ""; // Clear previous options
                    data.forEach(gioChieu => {
                        var option = document.createElement('option');
                        option.value = gioChieu.value;
                        option.text = gioChieu.text;
                        gioChieuDropdown.appendChild(option);
                    });

                    // Enable the submit button once GioChieu is selected
                    document.querySelector('input[type="submit"]').disabled = false;
                });
        } else {
            // Disable the submit button if no Phong is selected
            document.querySelector('input[type="submit"]').disabled = true;
        }
    });

    // Lắng nghe sự kiện submit của form
    $('#bulkCreateForm').submit(function (event) {
        // Kiểm tra xem form có hợp lệ không
        if (!$(this).valid()) {
            // Nếu không hợp lệ, ngăn chặn sự kiện submit mặc định
            event.preventDefault();

            // Hiển thị thông báo lỗi cho từng trường
            $('#formErrorSummary').html(''); // Xóa thông báo lỗi cũ
            $('#bulkCreateForm .text-danger').each(function () {
                var fieldName = $(this).prev('input, select').attr('id');
                var errorMessage = $(this).text();
                $('#formErrorSummary').append('<div>' + errorMessage + '</div>');
            });
        }
    });
</script>
<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }